{"version":3,"file":"app.js","sourceRoot":"","sources":["app.ts"],"names":[],"mappings":"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","sourcesContent":["const { app, BrowserWindow } = require('electron');\nconst path                   = require('path');\nconst shell                  = require('shelljs');\nconst join                   = path.join;\nconst spawn                  = require('child_process').spawn;\n\nimport { AppConsts } from \"./app/appConsts\";\n\nlet mainWindow;\nlet mongoProcess;\n\nconst logTag = '[NOSQLCLIENT]';\n\napp.commandLine.appendSwitch('remote-debugging-port', '9222');\n\nfunction createWindow(page)\n{\n\tmainWindow = new BrowserWindow({\n\t\twidth:          800,\n\t\theight:         600,\n\t\tresizable:      false,\n\t\twebPreferences: {\n\t\t\tnodeIntegration: true,\n\t\t},\n\t});\n\n\tmainWindow.loadFile(page);\n\n\tmainWindow.on('closed', function()\n\t{\n\t\tmainWindow = null;\n\t});\n}\n\nconst beginStartingMongo = function(appRoot)\n{\n\tconsole.log(logTag, 'trying to start mongod process');\n\tlet path = join(appRoot, 'app', 'bin', 'mongod');\n\tif(process.platform === 'win32')\n\t{\n\t\tpath += '.exe';\n\t}\n\tconsole.log(logTag, 'detected mongod executable path: ' + path);\n\n\tlet dataDir;\n\tlet lockfile;\n\n\tif(process.platform === 'win32')\n\t{\n\t\tdataDir = process.env.APPDATA;\n\t}\n\telse\n\t{\n\t\tif(process.platform === 'darwin')\n\t\t{\n\t\t\tdataDir = join(process.env.HOME, 'Library', 'Preferences');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(process.platform === 'linux')\n\t\t\t{\n\t\t\t\tdataDir = join(process.env.HOME, 'var', 'local');\n\t\t\t}\n\t\t}\n\t}\n\tdataDir  = join(dataDir, 'EmployeTest', AppConsts.dbName);\n\tlockfile = join(dataDir, 'mongod.lock');\n\tconsole.log(logTag, 'detected mongod data directory: ' + dataDir);\n\n\tconsole.log(logTag, 'trying to create data dir and removing mongod.lock just in case');\n\tshell.mkdir('-p', dataDir);\n\tshell.rm('-f', lockfile);\n\n\tconsole.log(logTag, 'trying to spawn mongod process with port: ' + AppConsts.mongoPort);\n\n\tmongoProcess = spawn(path, [\n\t\t'--dbpath', dataDir,\n\t\t'--port', AppConsts.mongoPort,\n\t\t'--bind_ip', '127.0.0.1',\n\t\t'--smallfiles',\n\t]);\n\n\tmongoProcess.stdout.on('data', function(data)\n\t{\n\t\tconsole.log(logTag, '[MONGOD-STDOUT]', data.toString());\n\n\t\tif(/waiting for connections/.test(data.toString()))\n\t\t{\n\t\t\tconsole.log(logTag, '[MONGOD-STDOUT]', \"waiting for connections\");\n\t\t\tcreateWindow('./app/index.html');\n\t\t}\n\t});\n\n\tmongoProcess.stderr.on('data', function(data)\n\t{\n\t\tconsole.error(logTag, '[MONGOD-STDERR]', data.toString());\n\t});\n\n\tmongoProcess.on('exit', function(code)\n\t{\n\t\tconsole.log(logTag, '[MONGOD-EXIT]', code.toString());\n\t});\n\n\tmongoProcess.on('error', function(err)\n\t{\n\t\tconsole.log(logTag, '[MONGOD-ERROR]', err.toString());\n\t\tcreateWindow('./app/error.html');\n\t});\n};\n\napp.on('ready', () =>\n{\n\tlet appRoot = path.resolve(__dirname);\n\tbeginStartingMongo(appRoot);\n});\n\napp.on('window-all-closed', function()\n{\n\t//context.shutdownServer();\n\n\tif(process.platform !== 'darwin') app.quit();\n});\n\n// app.on('activate', function()\n// {\n// \tif(mainWindow === null) createWindow();\n// });"]}