{"version":3,"file":"app.js","sourceRoot":"","sources":["app.ts"],"names":[],"mappings":"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","sourcesContent":["const { app, BrowserWindow } = require('electron');\r\nconst path                   = require('path');\r\nconst shell                  = require('shelljs');\r\nconst join                   = path.join;\r\nconst spawn                  = require('child_process').spawn;\r\n\r\nimport { AppConsts } from \"./appConsts\";\r\n\r\nlet mainWindow;\r\nlet mongoProcess;\r\n\r\nconst logTag = '[NOSQLCLIENT]';\r\n\r\napp.commandLine.appendSwitch('remote-debugging-port', '9222');\r\n\r\nfunction createWindow(page)\r\n{\r\n\tmainWindow    = new BrowserWindow({\r\n\t\twidth:          800,\r\n\t\theight:         600,\r\n\t\twebPreferences: {\r\n\t\t\tnodeIntegration: true,\r\n\t\t},\r\n\t});\r\n\r\n\tmainWindow.loadFile(page);\r\n\r\n\tmainWindow.on('closed', function()\r\n\t{\r\n\t\tmainWindow = null;\r\n\t});\r\n}\r\n\r\nconst beginStartingMongo = function(appRoot)\r\n{\r\n\tconsole.log(logTag, 'trying to start mongod process');\r\n\tlet path = join(appRoot, 'bin', 'mongod');\r\n\tif(process.platform === 'win32')\r\n\t{\r\n\t\tpath += '.exe';\r\n\t}\r\n\tconsole.log(logTag, 'detected mongod executable path: ' + path);\r\n\r\n\tlet dataDir;\r\n\tlet lockfile;\r\n\r\n\tif(process.platform === 'win32')\r\n\t{\r\n\t\tdataDir = process.env.APPDATA;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif(process.platform === 'darwin')\r\n\t\t{\r\n\t\t\tdataDir = join(process.env.HOME, 'Library', 'Preferences');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(process.platform === 'linux')\r\n\t\t\t{\r\n\t\t\t\tdataDir = join(process.env.HOME, 'var', 'local');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tdataDir  = join(dataDir, 'EmployeTest', AppConsts.dbName);\r\n\tlockfile = join(dataDir, 'mongod.lock');\r\n\tconsole.log(logTag, 'detected mongod data directory: ' + dataDir);\r\n\r\n\tconsole.log(logTag, 'trying to create data dir and removing mongod.lock just in case');\r\n\tshell.mkdir('-p', dataDir);\r\n\tshell.rm('-f', lockfile);\r\n\r\n\tconsole.log(logTag, 'trying to spawn mongod process with port: ' + AppConsts.mongoPort);\r\n\tmongoProcess = spawn(path, [\r\n\t\t'--dbpath', dataDir,\r\n\t\t'--port', AppConsts.mongoPort,\r\n\t\t'--bind_ip', '127.0.0.1',\r\n\t\t'--smallfiles',\r\n\t]);\r\n\r\n\tmongoProcess.stdout.on('data', function(data)\r\n\t{\r\n\t\tconsole.log(logTag, '[MONGOD-STDOUT]', data.toString());\r\n\r\n\t\tif(/waiting for connections/.test(data.toString()))\r\n\t\t{\r\n\t\t\tconsole.log(logTag, '[MONGOD-STDOUT]', \"waiting for connections\");\r\n\t\t\tcreateWindow('index.html');\r\n\t\t}\r\n\t});\r\n\r\n\tmongoProcess.stderr.on('data', function(data)\r\n\t{\r\n\t\tconsole.error(logTag, '[MONGOD-STDERR]', data.toString());\r\n\t});\r\n\r\n\tmongoProcess.on('exit', function(code)\r\n\t{\r\n\t\tconsole.log(logTag, '[MONGOD-EXIT]', code.toString());\r\n\t\tcreateWindow('error.html');\r\n\t});\r\n};\r\n\r\napp.on('ready', () =>\r\n{\r\n\tlet appRoot = path.resolve(__dirname);\r\n\tbeginStartingMongo(appRoot)\r\n});\r\n\r\napp.on('window-all-closed', function()\r\n{\r\n\t//context.shutdownServer();\r\n\r\n\tif(process.platform !== 'darwin') app.quit();\r\n});\r\n\r\n// app.on('activate', function()\r\n// {\r\n// \tif(mainWindow === null) createWindow();\r\n// });"]}